!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MediumEditorInsert=t():e.MediumEditorInsert=t()}(this,function(){return function(e){function t(n){if(i[n])return i[n].exports;var s=i[n]={exports:{},id:n,loaded:!1};return e[n].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=i(3),a=n(s),l=MediumEditor.Extension.extend({name:"insert",addons:{images:!0,embeds:!0},_initializedAddons:{},init:function(){MediumEditor.Extension.prototype.init.apply(this,arguments),this.core=new a.default(this)},destroy:function(){this.core.removeButtons()},getCore:function(){return this.core},getAddons:function(){return this._initializedAddons},getAddon:function(e){return this._initializedAddons[e]}});t.default=l,e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={ucfirst:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},generateRandomString:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15;return Math.random().toString(36).substr(2,e)},getClosestWithClassName:function(e,t){return MediumEditor.util.traverseUp(e,function(e){return e.classList.contains(t)})},isChildOf:function(e,t){return!!MediumEditor.util.traverseUp(e,function(e){return e===t})},getElementsByClassName:function(e,t){var i=[];return Array.prototype.forEach.call(e,function(e){var n=e.getElementsByClassName(t);Array.prototype.forEach.call(n,function(e){i.push(e)})}),i},getElementsByTagName:function(e,t){var i=[];return Array.prototype.forEach.call(e,function(e){var n=e.getElementsByTagName(t);Array.prototype.forEach.call(n,function(e){i.push(e)})}),i}};t.default=i,e.exports=t.default},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(1),d=n(r),c=i(4),u=n(c),h=MediumEditor.extensions.toolbar,m=function(e){function t(e){s(this,t);var i=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.name=e.type+"Toolbar",e.buttons.forEach(function(e){var t=new u.default(Object.assign({},{window:i.plugin.window,document:i.plugin.document,base:i.plugin.base},e));t.init(),i.plugin.base.extensions.push(t)}),i.window=e.plugin.window,i.document=e.plugin.document,i.base=e.plugin.base,i.init(),i}return l(t,e),o(t,[{key:"createToolbar",value:function(){var e=this.document.createElement("div");return e.id="medium-editor-insert-"+this.type+"-toolbar-"+this.getEditorId(),e.className="medium-editor-toolbar",this.static?e.className+=" static-toolbar":this.relativeContainer?e.className+=" medium-editor-relative-toolbar":e.className+=" medium-editor-stalker-toolbar",e.appendChild(this.createToolbarButtons()),this.forEachExtension(function(t){t.hasForm&&e.appendChild(t.getForm())}),this.attachEventHandlers(),e}},{key:"createToolbarButtons",value:function(){var e=this,t=this.document.createElement("ul"),i=void 0,n=void 0,s=void 0,a=void 0,l=void 0,o=void 0;return t.id="medium-editor-insert-"+this.type+"-toolbar-actions"+this.getEditorId(),t.className="medium-editor-toolbar-actions",t.style.display="block",this.buttons.forEach(function(s){"string"==typeof s?(l=s,o=null):(l=s.name,o=s),a=e.base.addBuiltInExtension(l,o),a&&"function"==typeof a.getButton&&(n=a.getButton(e.base),i=e.document.createElement("li"),MediumEditor.util.isElement(n)?i.appendChild(n):i.innerHTML=n,t.appendChild(i))},this),s=t.querySelectorAll("button"),s.length>0&&(s[0].classList.add(this.firstButtonClass),s[s.length-1].classList.add(this.lastButtonClass)),t}},{key:"checkState",value:function(){var e=this,t=void 0;this.base.preventSelectionUpdates||setTimeout(function(){return t=d.default.getElementsByClassName(e.getEditorElements(),e.activeClassName),0===t.length?e.hideToolbar():void e.showAndUpdateToolbar()},10)}},{key:"setToolbarPosition",value:function(){var e=d.default.getElementsByClassName(this.getEditorElements(),this.activeClassName)[0],t=void 0;return e?(this.showToolbar(),this.positionStaticToolbar(e),t=this.base.getExtensionByName("anchor-preview"),void(t&&"function"==typeof t.hidePreview&&t.hidePreview())):this}}]),t}(h);t.default=m,e.exports=t.default},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=i(1),o=n(l),r=i(6),d=n(r),c=i(5),u=n(c),h=function(){function e(t){s(this,e),this._plugin=t,this._editor=this._plugin.base,this.initAddons(),this.addButtons(),this.events()}return a(e,[{key:"events",value:function(){var e=this,t=void 0;this._plugin.on(document,"click",this.toggleButtons.bind(this)),this._plugin.on(document,"keyup",this.toggleButtons.bind(this)),this._plugin.on(this.buttons.getElementsByClassName("medium-editor-insert-buttons-show")[0],"click",this.toggleAddons.bind(this)),t=this.buttons.getElementsByClassName("medium-editor-insert-action"),Array.prototype.forEach.call(t,function(t){e._plugin.on(t,"click",e.handleAddonClick.bind(e))}),this._plugin.on(window,"resize",this.positionButtons.bind(this))}},{key:"initAddons",value:function(){var e=this;this._plugin._initializedAddons={images:new d.default(this._plugin,this._plugin.addons.images),embeds:new u.default(this._plugin,this._plugin.addons.embeds)},Object.keys(this._plugin.addons).forEach(function(t){var i=e._plugin.addons[t];e._plugin._initializedAddons[t]||("function"==typeof i?e._plugin._initializedAddons[t]=new i(e._plugin):window.console.error("I don't know how to initialize custom \""+t+'" addon!')),i||delete e._plugin._initializedAddons[t]})}},{key:"addButtons",value:function(){var e=this._plugin.getAddons(),t=void 0;this.buttons=document.createElement("div"),this.buttons.id="medium-editor-insert-"+this._plugin.getEditorId(),this.buttons.classList.add("medium-editor-insert-buttons"),this.buttons.setAttribute("contentediable",!1),t='<a class="medium-editor-insert-buttons-show">+</a>\n            <ul class="medium-editor-insert-buttons-addons">',Object.keys(e).forEach(function(i){var n=e[i];t+='<li><a class="medium-editor-insert-action" data-addon="'+i+'">'+n.label+"</a></li>"}),t+="</ul>",this.buttons.innerHTML=t,document.body.appendChild(this.buttons)}},{key:"removeButtons",value:function(){this.buttons.remove()}},{key:"positionButtons",value:function(){var e=void 0,t=void 0,i=void 0,n=void 0,s=void 0,a=void 0,l=void 0;this.buttons.classList.contains("medium-editor-insert-buttons-active")!==!1&&(e=this._editor.getSelectedParentElement(),t=e.getBoundingClientRect(),i=this.buttons.getElementsByClassName("medium-editor-insert-buttons-addons")[0],n=this.buttons.getElementsByClassName("medium-editor-insert-action")[0],s=window.getComputedStyle(i),a=window.getComputedStyle(n),l={top:window.scrollY+t.top,left:window.scrollX+t.left-parseInt(s.left,10)-parseInt(a.marginLeft,10)},l.left=l.left<0?t.left:l.left,this.buttons.style.left=l.left+"px",this.buttons.style.top=l.top+"px")}},{key:"toggleButtons",value:function(){var e=this._editor.getSelectedParentElement();this.shouldDisplayButtonsOnElement(e)?(this.selectElement(e),this.showButtons()):this.hideButtons()}},{key:"shouldDisplayButtonsOnElement",value:function(e){var t=this._plugin.getAddons(),i=[],n=!1,s=!1;return""===e.innerText.trim()&&(this._plugin.getEditorElements().forEach(function(t){if(o.default.isChildOf(e,t))return void(s=!0)}),!!s&&(Object.keys(t).forEach(function(e){var n=t[e];n.elementClassName&&i.push(n.elementClassName)}),i.forEach(function(t){if(e.classList.contains(t)||o.default.getClosestWithClassName(e,t))return void(n=!0)}),!n))}},{key:"selectElement",value:function(e){this.selectedElement=e}},{key:"showButtons",value:function(){this.buttons.classList.add("medium-editor-insert-buttons-active"),this.positionButtons()}},{key:"hideButtons",value:function(){this.buttons.classList.remove("medium-editor-insert-buttons-active"),this.buttons.classList.remove("medium-editor-insert-addons-active")}},{key:"toggleAddons",value:function(){this.buttons.classList.toggle("medium-editor-insert-addons-active")}},{key:"handleAddonClick",value:function(e){var t=e.currentTarget.getAttribute("data-addon");e.preventDefault(),this._plugin.getAddon(t).handleClick(e),this.hideButtons()}}]),e}();t.default=h,e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=MediumEditor.extensions.button.extend({init:function(){this.button=this.document.createElement("button"),this.button.classList.add("medium-editor-action"),this.button.classList.add(this.className),this.button.innerHTML="<b>"+this.label+"</b>",this.on(this.button,"click",this.handleClick.bind(this))},getButton:function(){return this.button},handleClick:function(){this.onClick()}});t.default=i,e.exports=t.default},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=i(1),o=n(l),r=i(2),d=n(r),c=function(){function e(t,i){s(this,e),this.options={label:'<span class="fa fa-youtube-play"></span>',placeholder:"Paste a YouTube, Vimeo, Facebook, Twitter or Instagram link and press Enter",oembedProxy:"http://medium.iframe.ly/api/oembed?omit_script=1&iframe=1",captions:!0,captionPlaceholder:"Type caption (optional)",storeMeta:!1,styles:{wide:{label:'<span class="fa fa-align-justify"></span>'},left:{label:'<span class="fa fa-align-left"></span>'},right:{label:'<span class="fa fa-align-right"></span>'}},actions:{remove:{label:'<span class="fa fa-times"></span>',clicked:function(){}}},parseOnPaste:!1},Object.assign(this.options,i),this._plugin=t,this._editor=this._plugin.base,this.activeClassName="medium-editor-insert-embeds-active",this.placeholderClassName="medium-editor-insert-embeds-placeholder",this.elementClassName="medium-editor-insert-embeds",this.loadingClassName="medium-editor-insert-embeds-loading",this.activeClassName="medium-editor-insert-embed-active",this.descriptionContainerClassName="medium-editor-embed-embed-description-container",this.descriptionClassName="medium-editor-embed-embed-description",this.overlayClassName="medium-editor-insert-embeds-overlay",this.alignLeftClassName="align-left",this.alignRightClassName="align-right",this.alignCenterClassName="align-center",this.alignCenterWideClassName="align-center-wide",this.alignCenterFullClassName="align-center-full",this.label=this.options.label,this.descriptionPlaceholder=this.options.descriptionPlaceholder,this.initToolbar(),this.events()}return a(e,[{key:"events",value:function(){var e=this;this._plugin.on(document,"click",this.unselectEmbed.bind(this)),this._plugin.on(document,"keydown",this.handleKey.bind(this)),this._plugin.getEditorElements().forEach(function(t){e._plugin.on(t,"click",e.selectEmbed.bind(e))})}},{key:"selectEmbed",value:function(e){var t=e.target;if(t.classList.contains(this.overlayClassName)){var i=o.default.getClosestWithClassName(t,this.elementClassName);i.classList.contains(this.loadingClassName)||(i.classList.add(this.activeClassName),this._editor.selectElement(i),this.activeEmbedElement=i)}}},{key:"unselectEmbed",value:function(e){var t=this,i=e.target,n=void 0,s=void 0;return!i.classList.contains(this.descriptionClassName)&&(s=o.default.getElementsByClassName(this._plugin.getEditorElements(),this.elementClassName),!(!s||!s.length)&&(i.classList.contains(this.overlayClassName)&&(n=o.default.getClosestWithClassName(i,this.elementClassName)),void(s&&Array.prototype.forEach.call(s,function(e){e!==n&&e.classList.remove(t.activeClassName)}))))}},{key:"getSiblingParagraph",value:function(e){if(!e)return!1;for(var t=e.nextSibling,i=void 0;t&&!i;)t&&"P"===t.tagName?i=t:t=t.nextSibling;return i}},{key:"handleKey",value:function(e){var t=e.target,i=t&&t.classList&&t.classList.contains(this.descriptionClassName);if([MediumEditor.util.keyCode.ENTER].indexOf(e.which)>-1&&i&&e.preventDefault(),[MediumEditor.util.keyCode.BACKSPACE,MediumEditor.util.keyCode.DELETE].indexOf(e.which)>-1&&!i&&this.removeEmbed(e),40===e.which||13===e.which){var n=document.querySelector("."+this.activeClassName);if(n){var s=this.getSiblingParagraph(n);if(!s){var a=document.createElement("p");a.innerHTML="<br>",n.insertAdjacentElement("afterend",a)}s=this.getSiblingParagraph(n),s&&(s.innerHTML||(s.innerHTML="<br>"),window.getSelection().removeAllRanges(),this._plugin.getCore()._editor.selectElement(s),n.classList.remove(this.activeClassName),MediumEditor.selection.clearSelection(document,!0),n.classList.remove(this.activeClassName),e.preventDefault())}}}},{key:"handleClick",value:function(){this.el=this._plugin.getCore().selectedElement,this.el.classList.add(this.loadingClassName),this.el.classList.add(this.placeholderClassName),this.el.setAttribute("data-placeholder",this.options.placeholder),this.instanceHandlePaste=this.handlePaste.bind(this),this.instanceHandleKeyDown=this.handleKeyDown.bind(this),this._plugin.on(document,"paste",this.instanceHandlePaste),this._plugin.on(document,"keydown",this.instanceHandleKeyDown),this._plugin.on(this.el,"blur",this.handleBlur.bind(this)),this._editor.elements[0].focus(),this.el.focus()}},{key:"handleKeyDown",value:function(e){return 17===e.which||91===e.which||224===e.which||27!==e.which&&this._plugin.selectedElement===this.el||(this.cancelEmbed(),!1)}},{key:"handlePaste",value:function(e){var t=e.clipboardData.getData("text"),i=new RegExp("^(http(s?):)?//","i"),n=new RegExp("^(www.)?","i");if(i.test(t)||n.test(t)){this.options.oembedProxy?this.oembed(t,!0):this.parseUrl(t,!0)}this.cancelEmbed()}},{key:"removeEmbed",value:function(e){var t=document.querySelector("."+this.activeClassName);t&&t.remove()}},{key:"initToolbar",value:function(){this.toolbar=new d.default({plugin:this._plugin,type:"embeds",activeClassName:this.activeClassName,buttons:[{name:"embed-align-left",action:"align-left",className:"btn-align-left",label:"Left",onClick:function(){this.changeAlign(this.alignLeftClassName)}.bind(this)},{name:"embed-align-center",action:"align-center",className:"btn-align-center",label:"Center",onClick:function(){this.changeAlign(this.alignCenterClassName)}.bind(this)},{name:"embed-align-center-wide",action:"align-center-wide",className:"btn-align-center-wide",label:"Wide",onClick:function(){this.changeAlign(this.alignCenterWideClassName)}.bind(this)},{name:"embed-align-center-full",action:"align-center-full",className:"btn-align-center-full",label:"Full",onClick:function(){this.changeAlign(this.alignCenterFullClassName)}.bind(this)},{name:"embed-align-right",action:"align-right",className:"btn-align-right",label:"Right",onClick:function(){this.changeAlign(this.alignRightClassName)}.bind(this)}]}),this._editor.extensions.push(this.toolbar)}},{key:"changeAlign",value:function(e){var t=this.activeEmbedElement;t.classList.remove(this.alignLeftClassName,this.alignRightClassName,this.alignCenterClassName,this.alignCenterWideClassName,this.alignCenterFullClassName),t.classList.add(e)}},{key:"oembed",value:function(e,t){var i=this,n=this.options.oembedProxy+"&url="+e,s=new XMLHttpRequest;return s.open("GET",n,!0),s.onreadystatechange=function(){if(4===s.readyState&&200===s.status){var t=JSON.parse(s.responseText);i.embed(t.html,e,t)}},s.send(),!0}},{key:"parseUrl",value:function(e,t){var i=void 0;return!!new RegExp(["youtube","youtu.be","vimeo","instagram","twitter","facebook"].join("|")).test(e)&&(i=e.replace(/\n?/g,"").replace(/^((http(s)?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/(watch\?v=|v\/)?)([a-zA-Z0-9\-_]+)(.*)?$/,'<div class="video video-youtube"><iframe width="420" height="315" src="//www.youtube.com/embed/$7" frameborder="0" allowfullscreen></iframe></div>').replace(/^https?:\/\/vimeo\.com(\/.+)?\/([0-9]+)$/,'<div class="video video-vimeo"><iframe src="//player.vimeo.com/video/$2" width="500" height="281" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>').replace(/^https:\/\/twitter\.com\/(\w+)\/status\/(\d+)\/?$/,'<blockquote class="twitter-tweet" align="center" lang="en"><a href="https://twitter.com/$1/statuses/$2"></a></blockquote><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>').replace(/^(https:\/\/www\.facebook\.com\/(.*))$/,'<script src="//connect.facebook.net/en_US/sdk.js#xfbml=1&amp;version=v2.2" async></script><div class="fb-post" data-href="$1"><div class="fb-xfbml-parse-ignore"><a href="$1">Loading Facebook post...</a></div></div>').replace(/^https?:\/\/instagram\.com\/p\/(.+)\/?$/,'<span class="instagram"><iframe src="//instagram.com/p/$1/embed/" width="612" height="710" frameborder="0" scrolling="no" allowtransparency="true"></iframe></span>'),/<("[^"]*"|'[^']*'|[^'">])*>/.test(i)!==!1&&(t?this.embed(i,e):this.embed(i)))}},{key:"embed",value:function(e,t,i){var n=void 0,s=void 0,a=void 0,l=void 0,o=void 0,r=void 0,d=void 0,c=void 0,u=void 0;if(!e)return console.error("Incorrect URL format specified: ",t),!1;if(i&&"link"===i.type)return console.error("Just common link — no any embeds to insert: ",t),!1;for(n=this._plugin.getCore().selectedElement,s=document.createElement("figure"),s.classList.add("medium-editor-insert-embeds-item"),a=document.createElement("div"),a.classList.add(this.descriptionContainerClassName),l=document.createElement("figcaption"),l.classList.add(this.descriptionClassName),l.setAttribute("contenteditable",!0),l.setAttribute("data-placeholder","Type caption for embed (optional)"),o=document.createElement("div"),o.classList.add(this.elementClassName),o.classList.add(this.alignCenterClassName),u=document.createElement("p"),u.innerHTML="<br>",o.setAttribute("contenteditable",!1),r=document.createElement("div"),r.classList.add("medium-editor-insert-embeds-item-container"),d=document.createElement("div"),d.classList.add(this.overlayClassName),o.appendChild(s),s.appendChild(r),s.appendChild(d),a.classList.add(this.descriptionContainerClassName),l.contentEditable=!0,l.classList.add(this.descriptionClassName),l.dataset.placeholder=this.descriptionPlaceholder,n.replaceWith(o),n.nextSibling||n.insertAdjacentElement("afterend",u),c=o.parentNode.lastChild;c&&1!==c.nodeType;)c=c.previousSibling;if(c===o){var h=document.createElement("p");h.appendChild(document.createElement("br")),o.parentNode.appendChild(h)}return r.innerHTML=e,this._editor.selectElement(o),e.indexOf("facebook")!==-1&&"undefined"!=typeof FB&&setTimeout(function(){FB.XFBML.parse()},2e3),this.options.onInsert&&this.options.onInsert(e),!0}},{key:"handleBlur",value:function(){console.log("blur")}},{key:"hidePlaceholder",value:function(){this.el.removeAttribute("data-placeholder"),this.el.classList.remove("medium-editor-insert-embeds-placeholder")}},{key:"cancelEmbed",value:function(){this.hidePlaceholder(),this.el.classList.remove("medium-editor-insert-embeds-active"),this._plugin.off(document,"paste",this.instanceHandlePaste),this._plugin.off(document,"keyup",this.instanceHandleKeyUp)}},{key:"destroy",value:function(){this.cancelEmbed()}}]),e}();t.default=c,e.exports=t.default},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=i(1),o=n(l),r=i(2),d=n(r),c=function(){function e(t,i){s(this,e),this.options={label:'<span class="fa fa-camera"></span>',preview:!0,uploadUrl:"upload.php",deleteUrl:"delete.php",deleteMethod:"DELETE",deleteData:{}},Object.assign(this.options,i),this._plugin=t,this._editor=this._plugin.base,this.elementClassName="medium-editor-insert-images",this.loadingClassName="medium-editor-insert-images-loading",this.activeClassName="medium-editor-insert-image-active",this.descriptionContainerClassName="medium-editor-embed-image-description-container",this.descriptionClassName="medium-editor-embed-image-description",this.alignLeftClassName="align-left",this.alignRightClassName="align-right",this.alignCenterClassName="align-center",this.alignCenterWideClassName="align-center-wide",this.alignCenterFullClassName="align-center-full",this.label=this.options.label,this.descriptionPlaceholder=this.options.descriptionPlaceholder,this.activeImageElement=null,this.initToolbar(),this.events()}return a(e,[{key:"events",value:function(){var e=this;this._plugin.on(document,"click",this.unselectImage.bind(this)),this._plugin.on(document,"keydown",this.handleKey.bind(this)),this._plugin.getEditorElements().forEach(function(t){e._plugin.on(t,"click",e.selectImage.bind(e))})}},{key:"handleClick",value:function(){var e=this;if(this.options.onInsertButtonClick){var t=o.default.generateRandomString();this.options.onInsertButtonClick(function(i){return e.insertImage(i,t)},function(i){return e.insertImage(i,t,!0)})}else this._input=document.createElement("input"),this._input.type="file",this._input.multiple=!0,this._plugin.on(this._input,"change",this.uploadFiles.bind(this)),this._input.click()}},{key:"initToolbar",value:function(){this.toolbar=new d.default({plugin:this._plugin,type:"images",activeClassName:this.activeClassName,buttons:[{name:"image-align-left",action:"align-left",className:"btn-align-left",label:"Left",title:"Left",onClick:function(){this.changeAlign("align-left")}.bind(this)},{name:"image-align-center",action:"align-center",className:"btn-align-center",label:"Center",title:"Center",onClick:function(){this.changeAlign("align-center")}.bind(this)},{name:"image-align-center-wide",action:"align-center-wide",className:"btn-align-center-wide",label:"Wide",title:"Wide",onClick:function(){this.changeAlign("align-center-wide")}.bind(this)},{name:"image-align-center-full",action:"align-center-full",className:"btn-align-center-full",label:"Full",title:"Full wide",onClick:function(){this.changeAlign("align-center-full")}.bind(this)},{name:"image-align-right",action:"align-right",className:"btn-align-right",label:"Right",title:"Right",onClick:function(){this.changeAlign("align-right")}.bind(this)}]}),this._editor.extensions.push(this.toolbar)}},{key:"changeAlign",value:function(e){var t=this.activeImageElement;t.classList.remove(this.alignLeftClassName,this.alignRightClassName,this.alignCenterClassName,this.alignCenterWideClassName,this.alignCenterFullClassName),t.classList.add(e)}},{key:"uploadFiles",value:function(){var e=this;Array.prototype.forEach.call(this._input.files,function(t){var i=o.default.generateRandomString();e.options.preview&&e.preview(t,i),e.upload(t,i)})}},{key:"preview",value:function(e,t){var i=this,n=new FileReader;n.onload=function(e){i.insertImage(e.target.result,t)},n.readAsDataURL(e)}},{key:"upload",value:function(e,t){var i=new XMLHttpRequest,n=new FormData,s=this.insertImage.bind(this);i.open("POST",this.options.uploadUrl,!0),i.onreadystatechange=function(){4===i.readyState&&200===i.status&&s(i.responseText,o.default.generateRandomString())},n.append("file",e),i.send(n)}},{key:"insertImage",value:function(e,t,i){var n=this._plugin.getCore().selectedElement;if("p"===n.nodeName.toLowerCase()){var s=document.createElement("div");n.parentNode.insertBefore(s,n),this._plugin.getCore().selectElement(s),n.remove()}var a=this._plugin.getCore().selectedElement.querySelector('[data-uid="'+t+'"]');a?this.replaceImage(a,e):this.addImage(e,t,i),this._plugin.getCore().hideButtons()}},{key:"addParagraph",value:function(e){var t=document.createElement("p");t.innerHTML="<br>",e.insertAdjacentElement("afterend",t)}},{key:"addImage",value:function(e,t,i){var n=this,s=this._plugin.getCore().selectedElement,a=document.createElement("figure"),l=document.createElement("img"),o=document.createElement("div"),r=document.createElement("figcaption"),d=void 0;return l.alt="",t&&l.setAttribute("data-uid",t),o.classList.add(this.descriptionContainerClassName),r.contentEditable=!0,r.classList.add(this.descriptionClassName),r.dataset.placeholder=this.descriptionPlaceholder,e.match(/^data:/)?(l.src=e,a.appendChild(l),s.appendChild(a)):(d=new Image,d.onload=function(){l.src=d.src,i||l.classList.add(n.activeClassName),a.appendChild(l),o.appendChild(r),a.appendChild(o),s.appendChild(a),s.nextSibling&&s.nextSibling.nextSibling||i||n.addParagraph(s)},d.src=e,i&&s.classList.add(this.loadingClassName)),s.classList.add(this.elementClassName),s.classList.add(this.alignCenterClassName),s.contentEditable=!1,d}},{key:"replaceImage",value:function(e,t){var i=new Image,n=this._plugin.getCore().selectedElement;return n.querySelector("img").classList.add(this.activeClassName),n.classList.remove(this.loadingClassName),n.nextSibling&&n.nextSibling.nextSibling||this.addParagraph(n),i.onload=function(){e.src=i.src,e.removeAttribute("data-uid")},i.src=t,i}},{key:"selectImage",value:function(e){var t=e.target;if("img"===t.nodeName.toLowerCase()&&o.default.getClosestWithClassName(t,this.elementClassName)){var i=t.parentNode.parentNode;i.classList.contains(this.loadingClassName)||(t.classList.add(this.activeClassName),i.classList.add(this.activeClassName),this._editor.selectElement(i),this.activeImageElement=i)}}},{key:"unselectImage",value:function(e){var t=this,i=e.target,n=void 0,s=void 0;return!i.classList.contains(this.descriptionClassName)&&("img"===i.nodeName.toLowerCase()&&i.classList.contains(this.activeClassName)&&(n=i),s=o.default.getElementsByClassName(this._plugin.getEditorElements(),this.activeClassName),void Array.prototype.forEach.call(s,function(e){e!==n&&e.classList.remove(t.activeClassName)}))}},{key:"getSiblingParagraph",value:function(e){if(!e)return!1;for(var t=e.nextSibling,i=void 0;t&&!i;)t&&"P"===t.tagName?i=t:t=t.nextSibling;return i}},{key:"handleKey",value:function(e){var t=e.target,i=t&&t.classList&&t.classList.contains(this.descriptionClassName);if([MediumEditor.util.keyCode.ENTER].indexOf(e.which)>-1&&i)return e.preventDefault();if([MediumEditor.util.keyCode.BACKSPACE,MediumEditor.util.keyCode.DELETE].indexOf(e.which)>-1&&!i&&this.removeImage(e),40===e.which||13===e.which){var n=document.querySelector("."+this.activeClassName),s=n&&n.parentNode.parentNode;if(s){var a=this.getSiblingParagraph(s);a||this.addParagraph(s),a=this.getSiblingParagraph(s),a&&(a.innerHTML||(a.innerHTML="<br>"),window.getSelection().removeAllRanges(),this._plugin.getCore()._editor.selectElement(a),MediumEditor.selection.clearSelection(document,!0),n.classList.remove(this.activeClassName),e.preventDefault())}}}},{key:"removeImage",value:function(e){var t=this,i=o.default.getElementsByClassName(this._plugin.getEditorElements(),this.activeClassName),n=window.getSelection(),s=void 0;if(n&&n.rangeCount){var a=MediumEditor.selection.getSelectionRange(document),l=MediumEditor.selection.getSelectedParentElement(a),r=MediumEditor.selection.getCaretOffsets(l).left,d=void 0;if(e.which===MediumEditor.util.keyCode.BACKSPACE&&0===r?d=l.previousElementSibling:e.which===MediumEditor.util.keyCode.DELETE&&r===l.innerText.length&&(d=l.nextElementSibling),d&&d.classList.contains("medium-editor-insert-images")){var c=d.getElementsByTagName("img");Array.prototype.forEach.call(c,function(e){i.push(e)})}if(s=MediumEditor.selection.getSelectionHtml(document)){var u=document.createElement("div"),h=void 0,m=void 0;u.innerHTML=s,h=u.getElementsByClassName("medium-editor-insert-images"),m=o.default.getElementsByTagName(h,"img"),Array.prototype.forEach.call(m,function(e){i.push(e)})}}i.length&&(s||e.preventDefault(),i.forEach(function(i){var n=o.default.getClosestWithClassName(i,"medium-editor-insert-images");if(t.deleteFile(i.src),i.parentNode.remove(),0===n.childElementCount){var a=n.nextElementSibling,l=n.previousElementSibling;n.remove(),s||(a||l)&&(a&&e.which===MediumEditor.util.keyCode.DELETE||!l?MediumEditor.selection.moveCursor(document,a,0):MediumEditor.selection.moveCursor(document,l.lastChild,l.lastChild.textContent.length))}}))}},{key:"deleteFile",value:function(e){if(this.options.deleteUrl){var t=new XMLHttpRequest,i=Object.assign({},{file:e},this.options.deleteData);t.open(this.options.deleteMethod,this.options.deleteUrl,!0),t.send(i)}}},{key:"destroy",value:function(){}}]),e}();t.default=c,e.exports=t.default}])});
//# sourceMappingURL=medium-editor-insert.min.js.map