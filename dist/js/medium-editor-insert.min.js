!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MediumEditorInsert=t():e.MediumEditorInsert=t()}(this,function(){return function(e){function t(n){if(i[n])return i[n].exports;var o=i[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(2),s=n(o),a=MediumEditor.Extension.extend({name:"insert",addons:{images:!0,embeds:!0},_initializedAddons:{},init:function(){MediumEditor.Extension.prototype.init.apply(this,arguments),this.core=new s.default(this)},destroy:function(){this.core.removeButtons()},getCore:function(){return this.core},getAddons:function(){return this._initializedAddons},getAddon:function(e){return this._initializedAddons[e]}});t.default=a,e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={ucfirst:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},generateRandomString:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15;return Math.random().toString(36).substr(2,e)},getClosestWithClassName:function(e,t){return MediumEditor.util.traverseUp(e,function(e){return e.classList.contains(t)})},isChildOf:function(e,t){return!!MediumEditor.util.traverseUp(e,function(e){return e===t})},getElementsByClassName:function(e,t){var i=[];return Array.prototype.forEach.call(e,function(e){var n=e.getElementsByClassName(t);Array.prototype.forEach.call(n,function(e){i.push(e)})}),i},getElementsByTagName:function(e,t){var i=[];return Array.prototype.forEach.call(e,function(e){var n=e.getElementsByTagName(t);Array.prototype.forEach.call(n,function(e){i.push(e)})}),i}};t.default=i,e.exports=t.default},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(1),l=n(a),r=i(6),u=n(r),d=i(5),c=n(d),h=function(){function e(t){o(this,e),this._plugin=t,this._editor=this._plugin.base,this.initAddons(),this.addButtons(),this.events()}return s(e,[{key:"events",value:function(){var e=this,t=void 0;this._plugin.on(document,"click",this.toggleButtons.bind(this)),this._plugin.on(document,"keyup",this.toggleButtons.bind(this)),this._plugin.on(this.buttons.getElementsByClassName("medium-editor-insert-buttons-show")[0],"click",this.toggleAddons.bind(this)),t=this.buttons.getElementsByClassName("medium-editor-insert-action"),Array.prototype.forEach.call(t,function(t){e._plugin.on(t,"click",e.handleAddonClick.bind(e))}),this._plugin.on(window,"resize",this.positionButtons.bind(this))}},{key:"initAddons",value:function(){var e=this;this._plugin._initializedAddons={images:new u.default(this._plugin,this._plugin.addons.images),embeds:new c.default(this._plugin,this._plugin.addons.embeds)},Object.keys(this._plugin.addons).forEach(function(t){var i=e._plugin.addons[t];e._plugin._initializedAddons[t]||("function"==typeof i?e._plugin._initializedAddons[t]=new i(e._plugin):window.console.error("I don't know how to initialize custom \""+t+'" addon!')),i||delete e._plugin._initializedAddons[t]})}},{key:"addButtons",value:function(){var e=this._plugin.getAddons(),t=void 0;this.buttons=document.createElement("div"),this.buttons.id="medium-editor-insert-"+this._plugin.getEditorId(),this.buttons.classList.add("medium-editor-insert-buttons"),this.buttons.setAttribute("contentediable",!1),t='<a class="medium-editor-insert-buttons-show">+</a>\n            <ul class="medium-editor-insert-buttons-addons">',Object.keys(e).forEach(function(i){var n=e[i];t+='<li><a class="medium-editor-insert-action" data-addon="'+i+'">'+n.label+"</a></li>"}),t+="</ul>",this.buttons.innerHTML=t,document.body.appendChild(this.buttons)}},{key:"removeButtons",value:function(){this.buttons.remove()}},{key:"positionButtons",value:function(){var e=void 0,t=void 0,i=void 0,n=void 0,o=void 0,s=void 0,a=void 0;this.buttons.classList.contains("medium-editor-insert-buttons-active")!==!1&&(e=this._editor.getSelectedParentElement(),t=e.getBoundingClientRect(),i=this.buttons.getElementsByClassName("medium-editor-insert-buttons-addons")[0],n=this.buttons.getElementsByClassName("medium-editor-insert-action")[0],o=window.getComputedStyle(i),s=window.getComputedStyle(n),a={top:window.scrollY+t.top,left:window.scrollX+t.left-parseInt(o.left,10)-parseInt(s.marginLeft,10)},a.left=a.left<0?t.left:a.left,this.buttons.style.left=a.left+"px",this.buttons.style.top=a.top+"px")}},{key:"toggleButtons",value:function(){var e=this._editor.getSelectedParentElement();this.shouldDisplayButtonsOnElement(e)?(this.selectElement(e),this.showButtons()):(this.deselectElement(),this.hideButtons())}},{key:"shouldDisplayButtonsOnElement",value:function(e){var t=this._plugin.getAddons(),i=[],n=!1,o=!1;return""===e.innerText.trim()&&(this._plugin.getEditorElements().forEach(function(t){if(l.default.isChildOf(e,t))return void(o=!0)}),!!o&&(Object.keys(t).forEach(function(e){var n=t[e];n.elementClassName&&i.push(n.elementClassName)}),i.forEach(function(t){if(e.classList.contains(t)||l.default.getClosestWithClassName(e,t))return void(n=!0)}),!n))}},{key:"selectElement",value:function(e){this.selectedElement=e}},{key:"deselectElement",value:function(){this.selectedElement=null}},{key:"showButtons",value:function(){this.buttons.classList.add("medium-editor-insert-buttons-active"),this.positionButtons()}},{key:"hideButtons",value:function(){this.buttons.classList.remove("medium-editor-insert-buttons-active"),this.buttons.classList.remove("medium-editor-insert-addons-active")}},{key:"toggleAddons",value:function(){this.buttons.classList.toggle("medium-editor-insert-addons-active")}},{key:"handleAddonClick",value:function(e){var t=e.currentTarget.getAttribute("data-addon");e.preventDefault(),this._plugin.getAddon(t).handleClick(e)}}]),e}();t.default=h,e.exports=t.default},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(1),u=n(r),d=i(4),c=n(d),h=MediumEditor.extensions.toolbar,m=function(e){function t(e){o(this,t);var i=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.name=e.type+"Toolbar",e.buttons.forEach(function(e){var t=new c.default(Object.assign({},{window:i.plugin.window,document:i.plugin.document,base:i.plugin.base},e));t.init(),i.plugin.base.extensions.push(t)}),i.window=e.plugin.window,i.document=e.plugin.document,i.base=e.plugin.base,i.init(),i}return a(t,e),l(t,[{key:"createToolbar",value:function(){var e=this.document.createElement("div");return e.id="medium-editor-insert-"+this.type+"-toolbar-"+this.getEditorId(),e.className="medium-editor-toolbar",this.static?e.className+=" static-toolbar":this.relativeContainer?e.className+=" medium-editor-relative-toolbar":e.className+=" medium-editor-stalker-toolbar",e.appendChild(this.createToolbarButtons()),this.forEachExtension(function(t){t.hasForm&&e.appendChild(t.getForm())}),this.attachEventHandlers(),e}},{key:"createToolbarButtons",value:function(){var e=this,t=this.document.createElement("ul"),i=void 0,n=void 0,o=void 0,s=void 0,a=void 0,l=void 0;return t.id="medium-editor-insert-"+this.type+"-toolbar-actions"+this.getEditorId(),t.className="medium-editor-toolbar-actions",t.style.display="block",this.buttons.forEach(function(o){"string"==typeof o?(a=o,l=null):(a=o.name,l=o),s=e.base.addBuiltInExtension(a,l),s&&"function"==typeof s.getButton&&(n=s.getButton(e.base),i=e.document.createElement("li"),MediumEditor.util.isElement(n)?i.appendChild(n):i.innerHTML=n,t.appendChild(i))},this),o=t.querySelectorAll("button"),o.length>0&&(o[0].classList.add(this.firstButtonClass),o[o.length-1].classList.add(this.lastButtonClass)),t}},{key:"checkState",value:function(){var e=this,t=void 0;this.base.preventSelectionUpdates||setTimeout(function(){return t=u.default.getElementsByClassName(e.getEditorElements(),e.activeClassName),0===t.length?e.hideToolbar():void e.showAndUpdateToolbar()},10)}},{key:"setToolbarPosition",value:function(){var e=u.default.getElementsByClassName(this.getEditorElements(),this.activeClassName)[0],t=void 0;return e?(this.showToolbar(),this.positionStaticToolbar(e),t=this.base.getExtensionByName("anchor-preview"),void(t&&"function"==typeof t.hidePreview&&t.hidePreview())):this}}]),t}(h);t.default=m,e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=MediumEditor.extensions.button.extend({init:function(){this.button=this.document.createElement("button"),this.button.classList.add("medium-editor-action"),this.button.innerHTML="<b>"+this.label+"</b>",this.on(this.button,"click",this.handleClick.bind(this))},getButton:function(){return this.button},handleClick:function(){console.log(this.name+" clicked!")}});t.default=i,e.exports=t.default},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=function(){function e(t,n){i(this,e),this._plugin=t,this._editor=this._plugin.base,this.options={label:'<span class="fa fa-youtube-play"></span>'},Object.assign(this.options,n),this.label=this.options.label}return n(e,[{key:"handleClick",value:function(){window.console.log("embeds clicked")}}]),e}();t.default=o,e.exports=t.default},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(1),l=n(a),r=i(3),u=n(r),d=function(){function e(t,i){o(this,e),this.options={label:'<span class="fa fa-camera"></span>',preview:!0,uploadUrl:"upload.php",deleteUrl:"delete.php",deleteMethod:"DELETE",deleteData:{}},Object.assign(this.options,i),this._plugin=t,this._editor=this._plugin.base,this.elementClassName="medium-editor-insert-images",this.activeClassName="medium-editor-insert-image-active",this.label=this.options.label,this.initToolbar(),this.events()}return s(e,[{key:"events",value:function(){var e=this;this._plugin.on(document,"click",this.unselectImage.bind(this)),this._plugin.on(document,"keydown",this.removeImage.bind(this)),this._plugin.getEditorElements().forEach(function(t){e._plugin.on(t,"click",e.selectImage.bind(e))})}},{key:"handleClick",value:function(){this._input=document.createElement("input"),this._input.type="file",this._input.multiple=!0,this._plugin.on(this._input,"change",this.uploadFiles.bind(this)),this._input.click()}},{key:"initToolbar",value:function(){this.toolbar=new u.default({plugin:this._plugin,type:"images",activeClassName:this.activeClassName,buttons:[{name:"align-left",action:"left",label:"Left"},{name:"align-center",action:"center",label:"Center"},{name:"align-right",action:"right",label:"Right"}]}),this._editor.extensions.push(this.toolbar)}},{key:"uploadFiles",value:function(){var e=this,t=this._plugin.getCore().selectedElement;if("p"===t.nodeName.toLowerCase()){var i=document.createElement("div");t.parentNode.insertBefore(i,t),this._plugin.getCore().selectElement(i),t.remove()}Array.prototype.forEach.call(this._input.files,function(t){var i=l.default.generateRandomString();e.options.preview&&e.preview(t,i),e.upload(t,i)}),this._plugin.getCore().hideButtons()}},{key:"preview",value:function(e,t){var i=this,n=new FileReader;n.onload=function(e){i.insertImage(e.target.result,t)},n.readAsDataURL(e)}},{key:"upload",value:function(e,t){var i=this,n=new XMLHttpRequest,o=new FormData;n.open("POST",this.options.uploadUrl,!0),n.onreadystatechange=function(){if(4===n.readyState&&200===n.status){var e=i._plugin.getCore().selectedElement.querySelector('[data-uid="'+t+'"]');e?i.replaceImage(e,n.responseText):i.insertImage(n.responseText)}},o.append("file",e),n.send(o)}},{key:"insertImage",value:function(e,t){var i=this._plugin.getCore().selectedElement,n=document.createElement("figure"),o=document.createElement("img"),s=void 0;return o.alt="",t&&o.setAttribute("data-uid",t),e.match(/^data:/)?(o.src=e,n.appendChild(o),i.appendChild(n)):(s=new Image,s.onload=function(){o.src=s.src,n.appendChild(o),i.appendChild(n)},s.src=e),i.classList.add(this.elementClassName),s}},{key:"replaceImage",value:function(e,t){var i=new Image;return i.onload=function(){e.src=i.src,e.removeAttribute("data-uid")},i.src=t,i}},{key:"selectImage",value:function(e){var t=e.target;"img"===t.nodeName.toLowerCase()&&l.default.getClosestWithClassName(t,this.elementClassName)&&(t.classList.add(this.activeClassName),this._editor.selectElement(t))}},{key:"unselectImage",value:function(e){var t=this,i=e.target,n=void 0,o=void 0;"img"===i.nodeName.toLowerCase()&&i.classList.contains(this.activeClassName)&&(n=i),o=l.default.getElementsByClassName(this._plugin.getEditorElements(),this.activeClassName),Array.prototype.forEach.call(o,function(e){e!==n&&e.classList.remove(t.activeClassName)})}},{key:"removeImage",value:function(e){var t=this;if([MediumEditor.util.keyCode.BACKSPACE,MediumEditor.util.keyCode.DELETE].indexOf(e.which)>-1){var i=l.default.getElementsByClassName(this._plugin.getEditorElements(),this.activeClassName),n=window.getSelection(),o=void 0;if(n&&n.rangeCount){var s=MediumEditor.selection.getSelectionRange(document),a=MediumEditor.selection.getSelectedParentElement(s),r=MediumEditor.selection.getCaretOffsets(a).left,u=void 0;if(e.which===MediumEditor.util.keyCode.BACKSPACE&&0===r?u=a.previousElementSibling:e.which===MediumEditor.util.keyCode.DELETE&&r===a.innerText.length&&(u=a.nextElementSibling),u&&u.classList.contains("medium-editor-insert-images")){var d=u.getElementsByTagName("img");Array.prototype.forEach.call(d,function(e){i.push(e)})}if(o=MediumEditor.selection.getSelectionHtml(document)){var c=document.createElement("div"),h=void 0,m=void 0;c.innerHTML=o,h=c.getElementsByClassName("medium-editor-insert-images"),m=l.default.getElementsByTagName(h,"img"),Array.prototype.forEach.call(m,function(e){i.push(e)})}}i.length&&(o||e.preventDefault(),i.forEach(function(i){var n=l.default.getClosestWithClassName(i,"medium-editor-insert-images");if(t.deleteFile(i.src),i.parentNode.remove(),0===n.childElementCount){var s=n.nextElementSibling,a=n.previousElementSibling;n.remove(),o||(s||a)&&(s&&e.which===MediumEditor.util.keyCode.DELETE||!a?MediumEditor.selection.moveCursor(document,s,0):MediumEditor.selection.moveCursor(document,a.lastChild,a.lastChild.textContent.length))}}))}}},{key:"deleteFile",value:function(e){if(this.options.deleteUrl){var t=new XMLHttpRequest,i=Object.assign({},{file:e},this.options.deleteData);t.open(this.options.deleteMethod,this.options.deleteUrl,!0),t.send(i)}}}]),e}();t.default=d,e.exports=t.default}])});
//# sourceMappingURL=medium-editor-insert.min.js.map